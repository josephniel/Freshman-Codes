<?php
	session_start();

	$searchQuery = $_GET['query'];
		 
	require_once('tcpdf/tcpdf.php');
			
	$pdf = 
		new TCPDF(
			$orientation =	'L', 
			$unit = 		'mm', 
			$format = 		'folio', 
			$unicode =		'true', 
			$encoding =		'UTF-8', 
			$diskcache =	false, 
			$pdfa =			false
		);
	$pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);
	$pdf->SetCreator(PDF_CREATOR);
	$pdf->SetAuthor('MedTrack Team');
	$pdf->SetTitle('Inventory Report');
	$pdf->SetSubject('Inventory Report');	
	$pdf->SetFont('Helvetica', '', 10);
	
	$pdf->SetPrintHeader(false);
	$pdf->SetPrintFooter(false);
	
	$pdf->SetMargins(8, 8, 8, 8);
	
	$pdf->AddPage();
			
	$html = '
		<html>
			<head>
				<style>
					td{ text-align: center; }
				</style>
			</head>	
			<body>
				<h1>Inventory Report</h1>';
						
				date_default_timezone_set("Asia/Manila");
										
	$html .= 
				'<h4>Date Generated: ' . date("m/d/Y") . ' ' . date("h:i a") . '</h4>
				<h4>Generated by: ' . $_SESSION['fullname'] . '</h4>
				<div style="margin-bottom:20px"></div>
					
				<p>** This report is sorted by ascending quantity</p>
				<table border="1" cellpadding="8">
					<tr>
						<td><b>Item Code</b></td>
						<td><b>Generic Name</b></td>
						<td><b>Brand Name</b></td>
						<td><b>Dosage</b></td>
						<td><b>Type</b></td>
						<td><b>Quantity</b></td>
					</tr>';
							
	include_once('./_connect.php');	
						
	$sql = 
		"SELECT * 
		FROM producttable, dynamicproducttable
		WHERE producttable.productId = dynamicproducttable.productId
		ORDER BY dynamicproducttable.totalQuantity, producttable.productId";
	$result = mysqli_query($connect, $sql);
					
	$withElements = false;
	while($row = mysqli_fetch_array($result)) {
		$withElements = true;
							
	$html .='
					<tr nobr="true"> 
						<td>' . $row['productId'] . '</td>
						<td>' . $row['genericName'] . '</td>
						<td>' . $row['brandName'] . '</td>
						<td>' . $row['dosage'] . '</td>
						<td>' . $row['type'] . '</td>
						<td>' . $row['totalQuantity'] . '</td>
					</tr>' ;
	}
	
	$html .='
				</table>
			</body>
		<html>';
			
	
	ob_clean(); 		
	
	$pdf->writeHTML(
		$html,
		$ln = true,
		$fill = false,
		$reseth = false,
		$cell = false,
		$align = '' );
	$pdf->lastPage();
	
	ob_end_clean();
	
	$pdf->Output('Inventory Report.pdf','I');